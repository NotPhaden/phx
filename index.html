<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard - PHX</title>
<link rel="icon" type="image/png" href="logo.png">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0b0b0b;
  --card:#1f1b24;
  --muted:#a9a4b1;
  --accent:#6f4bd8;
  font-family: 'Inter', system-ui;
}
*{box-sizing:border-box;}
html,body{height:100%;margin:0;background:var(--bg);color:white;}
.app{display:flex;min-height:100vh;}
.sidebar{width:260px;background:linear-gradient(180deg,#0f0e10 0%, #1b1620 100%);padding:24px 18px;border-right:1px solid rgba(255,255,255,0.02);}
.logo{display:flex;align-items:center;margin-bottom:18px;}
.logo img{width:40px;height:40px;margin-right:10px;}
.logo span{font-weight:800;color:#cfc7ff;font-size:16px;letter-spacing:1px;}
.menu{margin-top:12px;}
.menu a{display:block;padding:12px 10px;border-radius:10px;color:var(--muted);text-decoration:none;margin-bottom:6px;}
.menu a.active{background:linear-gradient(90deg,var(--accent),#3b2aa3);color:#fff;}
.menu .section-title{font-size:12px;color:var(--muted);text-transform:uppercase;margin:18px 0 8px;}
.main{flex:1;padding:30px 36px;overflow:auto;position:relative;}
.header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;}
.header h1{margin:0;font-size:22px;}
.user-profile{display:flex;align-items:center;cursor:pointer;}
.user-profile img{width:60px;height:60px;border-radius:50%;margin-right:12px;object-fit:cover;}
.user-profile span{font-weight:700;color:#fff;font-size:18px;}

.grid{display:grid;grid-template-columns:repeat(12,1fr);grid-gap:18px;margin-top:18px;}
.status-card,.players-card{background:var(--card);border-radius:14px;padding:20px;border:1px solid rgba(255,255,255,0.03);min-height:160px;display:flex;flex-direction:column;justify-content:center;grid-column:span 4;position:relative;overflow:hidden;}
.icon-box{width:38px;height:38px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;margin-bottom:12px;}
.status-card .icon-box{background:rgba(0,255,100,0.15);}
.players-card .icon-box{background:rgba(120,140,255,0.15);}
.status-big{font-size:20px;font-weight:700;margin-bottom:4px;}
.small-text{color:var(--muted);font-size:13px;}
.dot{width:10px;height:10px;border-radius:50%;position:absolute;right:16px;top:16px;}
.card{background:var(--card);border-radius:14px;padding:20px;display:flex;flex-direction:column;justify-content:center;border:1px solid rgba(255,255,255,0.03);min-height:160px;}
.stat{grid-column:span 4;}
.stat .title{font-size:13px;color:var(--muted);text-transform:uppercase;margin-bottom:6px;}
.stat .value{font-weight:700;font-size:20px;margin-bottom:6px;}
.server-feed{grid-column:span 5;}
.top-players{grid-column:span 3;}

#loadingScreen{position:fixed;top:0;left:0;width:100%;height:100%;background:var(--bg);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:2000;color:#fff;font-size:20px;}
#loadingScreen img{width:120px;height:120px;margin-bottom:20px;}
#loginContainer{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);display:none;justify-content:center;align-items:center;z-index:1000;}
#loginContainer input{width:100%;margin-bottom:12px;padding:10px;border-radius:8px;background:#1f1b24;color:#fff;border:none;}
#loginContainer button{width:100%;padding:10px;background:linear-gradient(90deg,#6f4bd8,#3b2aa3);color:#fff;border:none;border-radius:8px;font-weight:600;margin-bottom:8px;}

#profileOverlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);display:none;justify-content:center;align-items:center;z-index:1500;}
#profileOverlay div{background:#1f1b24;padding:30px;border-radius:14px;width:350px;text-align:center;}
#profileOverlay input{width:100%;margin-bottom:12px;padding:10px;border-radius:8px;background:#0f0e10;color:#e9e8ee;border:none;}
#profileOverlay button{padding:10px;margin-bottom:8px;width:100%;background:linear-gradient(90deg,#6f4bd8,#3b2aa3);color:white;border:none;border-radius:8px;}

</style>
</head>

<body>

<div id="loadingScreen">
  <img src="logo.png">
  <p>Loading...</p>
</div>

<div id="loginContainer">
  <div>
    <h2>Login / Register</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="ParolƒÉ">
    <button id="loginBtn">Login</button>
    <button id="registerBtn">Register</button>
    <p id="loginError" style="color:red;"></p>
  </div>
</div>

<div id="profileOverlay">
  <div>
    <h2>Profil</h2>
    <input type="text" id="profileName" placeholder="Nume">
    <input type="text" id="profileID" placeholder="ID Server">
    <input type="text" id="profileAvatar" placeholder="URL PozƒÉ Profil">
    <button id="saveProfileBtn">SalveazƒÉ</button>
    <button id="closeProfileBtn">√énchide</button>
    <p id="profileMessage"></p>
  </div>
</div>

<div class="app" style="display:none;">
  <aside class="sidebar">
    <div class="logo">
      <img src="logo.png"><span>PHX ROLEPLAY</span>
    </div>
    <div class="menu">
      <div class="section-title">Menu</div>
      <a class="active" href="#">Home</a>
      <a href="#" id="logoutBtn">Logout</a>
    </div>
  </aside>

  <main class="main">
    <div class="header">
      <h1>Dashboard</h1>
      <div class="user-profile" id="profileMenuBtn">
        <img src="logo.png" id="headerAvatar">
        <span id="headerName">User</span>
      </div>
    </div>

    <div class="grid">
      <div class="status-card">
        <div class="icon-box">üñ•Ô∏è</div>
        <div class="dot" id="statusDot"></div>
        <div class="status-big" id="serverStatusText">Loading...</div>
        <div class="small-text">Server Status</div>
      </div>

      <div class="players-card">
        <div class="icon-box">üë•</div>
        <div class="status-big" id="onlinePlayers">Loading...</div>
        <div class="small-text">Online Players</div>
      </div>
    </div>
  </main>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCNmtNk-qgYbTBFtz-fvT4lqCiKaUhIwZU",
  authDomain: "phxrp-a6554.firebaseapp.com",
  projectId: "phxrp-a6554",
  storageBucket: "phxrp-a6554.firebasestorage.app",
  messagingSenderId: "413786501080",
  appId: "1:413786501080:web:34a391f66e58acc45a8cad",
  measurementId: "G-K935NMKEZL"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

// UI
const loading = document.getElementById("loadingScreen");
const login = document.getElementById("loginContainer");
const appUI = document.querySelector(".app");
const loginError = document.getElementById("loginError");

const profileOverlay = document.getElementById("profileOverlay");
const profileName = document.getElementById("profileName");
const profileID = document.getElementById("profileID");
const profileAvatar = document.getElementById("profileAvatar");
const headerName = document.getElementById("headerName");
const headerAvatar = document.getElementById("headerAvatar");
const profileMessage = document.getElementById("profileMessage");

// Loading screen hide
setTimeout(() => {
  loading.style.display="none";
  login.style.display="flex";
},1200);

// LOGIN
loginBtn.addEventListener("click", () => {
  signInWithEmailAndPassword(auth, email.value, password.value)
  .then(() => loginError.textContent="")
  .catch(err => loginError.textContent=err.message);
});

// REGISTER
registerBtn.addEventListener("click", () => {
  createUserWithEmailAndPassword(auth, email.value, password.value)
  .then(u => {
    set(ref(db,"users/"+u.user.uid),{
      name:"",
      avatar:"",
      serverID:"",
      email:u.user.email
    });
  })
  .catch(err => loginError.textContent=err.message);
});

// AUTO LOGIN
onAuthStateChanged(auth, user => {
  if(user){
    login.style.display="none";
    appUI.style.display="flex";
    loadProfileData(user.uid);
  }else{
    appUI.style.display="none";
    login.style.display="flex";
  }
});

// LOGOUT
logoutBtn.addEventListener("click",()=>signOut(auth));

// OPEN PROFILE
profileMenuBtn.onclick=()=>profileOverlay.style.display="flex";
closeProfileBtn.onclick=()=>profileOverlay.style.display="none";

// SAVE PROFILE
saveProfileBtn.onclick=()=>{
  const user = auth.currentUser;
  if(!user) return;

  set(ref(db,"users/"+user.uid),{
    name:profileName.value,
    avatar:profileAvatar.value,
    serverID:profileID.value,
    email:user.email
  }).then(()=>{
    headerName.textContent = profileName.value || user.email;
    headerAvatar.src = profileAvatar.value || "logo.png";
    profileMessage.textContent = "‚úî Salvat!";
    setTimeout(()=>profileMessage.textContent="",1500);
  });
};

// LOAD PROFILE DATA
function loadProfileData(uid){
  get(ref(db,"users/"+uid)).then(snap=>{
    if(!snap.exists()) return;
    const d = snap.val();

    profileName.value = d.name || "";
    profileID.value = d.serverID || "";
    profileAvatar.value = d.avatar || "";

    headerName.textContent = d.name || d.email;
    headerAvatar.src = d.avatar?.trim() ? d.avatar : "logo.png";
  });
}

// SERVER STATUS
async function updateServerData(){
  try{
    const r = await fetch("https://servers-frontend.fivem.net/api/servers/single/vz8zjk");
    const d = await r.json();

    const online = d?.Data;
    const p = d?.Data?.clients ?? 0;
    const max = d?.Data?.sv_maxclients ?? 0;

    onlinePlayers.textContent = `${p}/${max}`;
    serverStatusText.textContent = online ? "Online" : "Offline";
    statusDot.style.background = online ? "#48ff76" : "red";
  }catch{
    onlinePlayers.textContent="N/A";
    serverStatusText.textContent="Offline";
    statusDot.style.background="red";
  }
}

updateServerData();
setInterval(updateServerData,8000);

</script>
</body>
</html>
